<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: 'zh-CN' }}">
<head>
    {% if site.ga4_measurement_id %}
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ site.ga4_measurement_id }}"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);} gtag('js', new Date());
        gtag('config', '{{ site.ga4_measurement_id }}');
    </script>
    {% endif %}

    {%- include head.html -%}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--移动端提示-->
    <script src="/assets/js/mobile-alert.js" defer></script>
    <title>{{ page.title }} | {{ site.title }}</title>
    <link rel="stylesheet" href="{{ '/assets/css/background.css' | relative_url }}">
    {{ content_for_header }}
    <!-- 引入 MathJax -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body>
    <script src="{{ '/assets/js/mac_code.js' | relative_url }}" defer></script>
    <script src="{{ '/assets/js/click-values.js' | relative_url }}" defer></script>

    <!-- 全站公用导航栏 -->
    {% include nav.html %}

    <!-- 主内容区 -->
    <main class="subpage-container">
        {%- comment -%}
        如果这是 notes 目录下的 index 页面，就渲染系列卡片列表；否则输出常规内容
        {%- endcomment -%}
        {% assign dir = page.dir %}
        {% assign note_index = dir | append: 'index.html' %}

        {% if dir contains '/notes/' and page.url == dir %}
        <!-- 渲染 /notes/ 本身 的系列卡片列表 -->
        <header class="section-header">
            <h1>{{ page.title }}</h1>
        </header>
        <div class="post-grid">
            {% assign these = site.pages
            | where: "dir", page.dir
            | reject: "url", page.url
            | sort: "date"
            | reverse %}
            {% for note in these %}
            {%- assign filename = note.path | split:'/' | last -%}
            {% unless filename == "index.html" or filename == "index.md" %}
            <article class="post-card">
                <h3 class="post-title">
                    <a href="{{ note.url }}" target="_blank" rel="noopener noreferrer">
                        {{ note.title }}
                    </a>
                </h3>
                <p class="post-excerpt">
                    {{ note.excerpt | default: note.content | truncatewords: 15 }}
                </p>
                <time class="post-date">🕒 {{ note.date | date: "%Y-%m-%d" }}</time>
            </article>
            {% endunless %}
            {% endfor %}
        </div>

        {% elsif dir contains '/notes/' and page.url == note_index %}
        <!-- 渲染 /notes/index.html 的系列卡片列表（同上） -->
        <header class="section-header">
            <h1>{{ page.title }}</h1>
        </header>
        <div class="post-grid">
            {% assign these = site.pages
            | where: "dir", page.dir
            | reject: "url", page.url
            | sort: "date"
            | reverse %}
            {% for note in these %}
            {%- assign filename = note.path | split:'/' | last -%}
            {% unless filename == "index.html" or filename == "index.md" %}
            <article class="post-card">
                <h3 class="post-title">
                    <a href="{{ note.url }}" target="_blank" rel="noopener noreferrer">
                        {{ note.title }}
                    </a>
                </h3>
                <p class="post-excerpt">
                    {{ note.excerpt | default: note.content | truncatewords: 30 }}
                </p>
                <time class="post-date">🕒 {{ note.date | date: "%Y-%m-%d" }}</time>
            </article>
            {% endunless %}
            {% endfor %}
        </div>

        {% else %}
        <!-- 普通页面仍然输出原生 Markdown 内容 -->
        {{ content }}
        {% endif %}
    </main>

    <!-- ====== 评论区（放在正文下方、页面最底） ====== -->
    <!--<div id="comments" class="giscus"></div>
    <script src="https://giscus.app/client.js"
            data-repo="Invincible-ZHANG/Technical-Interview-NOTE-Baguwen-Style"
            data-repo-id="R_kgDOPlZeaQ"
            data-category="Comments"
            data-category-id="DIC_kwDOPlZeAc4Ct2gH"
            data-mapping="pathname"
            data-strict="0"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="bottom"
            data-theme="noborder_dark"
            data-lang="zh-CN"
            data-loading="lazy"
            crossorigin="anonymous"
            async>
    </script>-->
    <!-- ====== 评论区结束 ====== -->
    {{ content_for_footer }}
</body>
</html>
