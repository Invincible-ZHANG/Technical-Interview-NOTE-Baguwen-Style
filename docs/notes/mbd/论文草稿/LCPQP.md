---
title: 多体系统LCP模型转换为QP的严格性分析
date: 2025-08-08
layout: note
excerpt: 关于LCP和QP问题的转化是否是近似的？。:)
---

# 多体系统LCP模型转换为QP的严格性分析

## 原始约束与LCP→QP转化的条件

原始的多体接触/摩擦约束满足线性互补问题(LCP)的等价QP条件需要相当严格的假设。
特别是要求[系统矩阵对称正定和约束集凸](##-相关知识点)。





对于无摩擦的接触（纯单侧约束），接触力可通过对称的Delassus矩阵 $N = D^T M^{-1} D$ 构造正定二次型；此时LCP可视为某个QP的KKT条件，满足等价转换条件。然而，引入库仑摩擦后，法向与切向约束耦合导致非线性互补问题（NCP），不再满足直接转化为凸QP的充分条件。论文指出基于库仑摩擦的DVI离散化会形成一个非凸的互补问题，需要特殊处理。因此，原始约束并未天然满足将LCP严格等价为QP的条件。必须通过假设或修改（如对称化、凸化）使问题满足凸QP条件。正如论文所述，他们通过引入决策(D3)对NCP进行凸化，使之成为圆锥互补问题(CCP)，这依赖于接触矩阵$N$的对称半正定性并将摩擦锥约束视为凸集Υ_i。只有经过这样的处理，才能将原始问题转换为在凸约束下求解的QP。总之，在未作特殊处理前，原始库仑摩擦约束不具备LCP到QP严格等价的充分条件，需通过对模型加以假设和修正（如将NCP凸化为CCP）才能建立等价的QP模型。
APGD求解的QP与原始LCP（KKT）的关系
APGD方法实际求解的是由接触互补问题的KKT条件形成的QP。论文明确指出，经过上述凸化处理后，摩擦接触问题可表述为带圆锥约束的二次优化问题 (Equation 11)，其一阶最优性条件正是圆锥互补形式。也就是说，该QP的KKT条件等价于求解松弛后接触问题的互补条件(CCP)。APGD（加速投影梯度下降）利用Nesterov方法，在每个仿真步求解这个带摩擦锥约束的QP，以求出法向和摩擦方向的约束力。实际上，APGD方法等价于求解上述QP的对偶形式：正如论文所述，通过放松原始问题得到的凸优化问题的对偶形式“实质上就是本文采用的方法”。因此，APGD并非直接求原始LCP，而是求解来自（松弛后）LCP的KKT条件对应的QP。这一QP的目标函数一般是$ \frac{1}{2}\gamma^T N \gamma + r^T \gamma$，其中$\gamma$为未知冲量/约束力，$N$为接触的Schur补矩阵，$r$为外力和上一时刻状态形成的项。QP的约束$\gamma_i\in Υ_i$即各接触力需位于库仑摩擦圆锥内。APGD通过迭代$\gamma$使其满足KKT：梯度步相当于计算$N\gamma + r$，投影步将$\gamma$投影回摩擦锥可行域。综上，APGD求解的正是松弛后接触问题KKT条件对应的QP，从数值角度保证了等价于该松弛互补问题的解。需要注意，这里的KKT对应的是经过凸化/松弛处理后的问题，而非未经松弛的原始NCP模型。
摩擦锥投影、互补松弛与伪变量的近似处理
在该方法中，库仑摩擦约束通过圆锥投影精确处理，而法向-切向互补条件则经过松弛处理，引入了一定近似。具体而言：
- 摩擦锥投影： APGD算法在每次梯度更新后对解进行投影，确保摩擦力$\gamma_{i,u}, \gamma_{i,w}$落在摩擦圆锥$Υ_i$内，即满足$\sqrt{\gamma_{i,u}^2+\gamma_{i,w}^2}\le \mu_i \gamma_{i,n}$。这一投影实现了库仑摩擦的最大耗散原则，相当于在切向方向上寻找使滑动速度最小的力 (见论文Eq.7)。该投影是非光滑但物理精确的（没有对摩擦锥进行光滑近似），因此摩擦锥约束本身未被放宽，而是通过凸投影严格施加。代码层面，约束类也将摩擦约束标记为Mode::FRICTION并在求解时投影到摩擦锥上；投影操作会确保法向反力非负、切向力被截断在允许圆锥内（例如基础类默认将负向反力置零，派生类会对切向分量按$\mu$约束剪切）。因此摩擦锥约束的处理是通过投影实现的精确满足，并未通过引入光滑伪变量等来近似摩擦锥。
•	互补条件松弛： 主要的近似来源于法向非穿透互补条件的放松。原始NCP中法向速度与法向冲量满足$v_n \ge 0,\ \gamma_n \ge 0,\ v_n\gamma_n=0$，且$v_n$公式中包含摩擦项(如De Saxcé等提出的广义速度$v_n + \mu |v_T|$)。本文通过减去该摩擦耦合项$\mu|v_T|$来修改法向速度表达式。这意味着法向约束不再耦合切向滑动速度，从而将原本的广义互补条件转化为标准形式 $0\le v_n^\text{(mod)} \perp \gamma_n \ge 0$。这种处理等价于互补条件的凸化/松弛：舍弃了摩擦对法向约束的影响，使法向约束独立且凸。这一步引用了Anitescu和Hart的方法并在论文Eq.(9)中给出松弛后的条件。因此，法向-切向互补被分解为一个圆锥约束，这是核心的近似。代码实现中并未显式出现$\mu|v_T|$项，这表明求解时已采用解耦形式：法向约束只关注法向速度与冲力的互补，摩擦通过锥约束处理。这种松弛使问题变为凸规划，但牺牲了原模型的严格互补耦合关系。
•	伪变量与松弛参数： 在代码中看到约束柔化参数（如“约束力混合”CFM）被提供，用于引入一个人工柔顺度以缓解数值奇异。CFM在约束方程中加入$ \text{cfm} \cdot \lambda$项，相当于引入虚拟弹簧以允许微小侵入。这是一种常见的数值松弛技巧，但在论文方法中并未重点使用，通常默认设为0保持理想刚性（CFM主要在需要稳定迭代时才启用）。此外，接触稳定项$1/h \Phi(q^{(l)})$（见下节）本身可视作引入了一个伪速度/位移变量用于消除穿透。总体而言，该方法主要通过物理模型层面的松弛（修改互补公式）来获得QP，而非增加额外伪变量来线性化摩擦锥或光滑库仑摩擦。摩擦求解未采用正则化（如粘滑过渡），而是直接投影，保持了库仑模型的非光滑特性。必要时的CFM/柔化仅是为数值稳健性提供，可视为与Anitescu等方法中的松弛类似的概念，但它不是模型转换的核心步骤。
从DVI/NCP到CCP/QP：严格等价还是松弛近似？
论文明确指出从原始DVI经过NCP再到CCP最后形成QP的过程中，采用了松弛（Relaxation），因此并非严格等价转换。特别是，他们放松了非穿透互补条件 (由Eq.(6)到Eq.(9) 的变化) 来实现凸化。作者称此为“凸化决策”，带来了方便求解的同时也引入了差别。文中明确提到：“CCP是通过放松非渗透互补条件得到的”；换言之，DVI→NCP→CCP→QP的过程属于近似（Relaxed）处理而非严格等价变换。该松弛使得得到的优化问题成为凸的并且有全局解，但牺牲了一些物理精确性。论文指出这一方法属于“松弛的方法 (relaxed methodology)”，在高速滑动摩擦情况下会出现人工效应。因此可以肯定地说，论文将原始互补问题松弛为圆锥QP是一种近似而非严格对应，这一点在文中有清晰表述。作者还特别讨论了此松弛的利弊：好处是问题变凸可以使用更广泛高效的优化算法，坏处是引入的松弛可能造成非物理伪影(artifact)。综上，DVI→NCP→CCP→QP的过程在论文中被说明为松弛近似的方法，并非严格无损转换。
接触速度“凸化”处理及代码实现
论文和代码均体现了对接触速度条件的凸化处理。所谓接触速度凸化，即修改非穿透条件使之线性且凸，从而避免原始非线性互补。具体表现在：
- Anitescu松弛法向速度条件： 原始模型采用了Anitescu提出的时间积分方案，在碰撞处理上没有即时速度反弹，而是通过在非穿透约束中加入穿透深度项，实现一步内消除侵入。论文中的非穿透约束引入了$\frac{1}{h}\Phi_i(q^{(l)})$项 (其中$\Phi$是两刚体间当前的侵入深度)，保证在一个时间步消除该侵入。这相当于Stewart-Trinkle方法中的修正间隙函数：用上一时刻的微小侵入来产生额外法向反力，从而避免累积穿透。代码中亦支持这一做法，将$1/h \Phi$加到约束右端$b_i$以稳定约束。这种处理有时称为“modified gap function”或Baumgarte稳定，在模型上属于合理的数值措施，不会破坏库仑摩擦模型，只是消除了接触的恢复弹性(导致碰撞按完全非弹性处理)。论文也指出，当时间步$h \to 0$时，这种离散化解将收敛于原连续DVI解，验证了该松弛在微小步长下不改变物理本质。
•	法向条件凸化 (取消摩擦速度项)： 如前述，论文通过在法向相对速度中减去$\mu|v_T|$项，实现了对摩擦-法向耦合的凸化。De Saxcé等提出的原始条件是$v_n + \mu |v_T| \ge 0 \perp \gamma_n \ge 0$，而代码/算法实际采用的是$v_n^\text{mod} \ge 0 \perp \gamma_n \ge 0$，其中$v_n^\text{mod} = v_n + \frac{1}{h}\Phi$不再含摩擦速度影响。这一步是关键的凸化处理(正是Anitescu and Hart (2004) 方法)：将原本耦合非凸的条件替换为线性条件，使问题转为标准LCP形式求解。代码层面来看，接触约束被划分为独立的法向约束和两个切向约束（Mode分别为UNILATERAL和FRICTION），并没有出现混合$v_n, v_t$的互补关系，而是在迭代中分别处理：法向投影保证非负接触速度，切向通过QP优化满足摩擦锥界限。由此推断，代码实现了与论文一致的凸化接触速度处理：采用修改后的法向速度条件和独立的摩擦约束来替代原始耦合互补条件。
综上，代码和论文都采用了Anitescu时间步松弛（接触稳定项）和摩擦耦合项移除这两种方式对接触速度条件进行凸化处理，使问题变为适合QP/APGD求解的形式。
互补性损失及物理影响评估
将原始LCP/NCP转化为QP求解确实牺牲了一定的精确互补性，可能引入非物理影响。首先，法向-切向互补条件的松弛意味着严格的库仑摩擦条件略有偏离：由于使用修改后的接触速度判据，求解得到的摩擦力方向和大小会与原模型略有差异。论文指出，此松弛使得所得解的摩擦力方向和大小发生轻微改变，但仍然满足摩擦圆锥约束，只是细节有所不同。这种差异在极端工况下表现为数值伪影。例如，在高滑动速度、高摩擦系数场景，模拟出现接触点的抖动(jitter)。作者通过一个高速滑动球体的算例观察到：松弛方法在高速滑移阶段出现了不真实的振荡，而未松弛的原始方法则无此现象。这种抖动被视为松弛引入的非物理效应。其次，QP模型本身由于$N$矩阵为半正定，会存在解的不唯一性，这在刚体摩擦接触中是已知问题。松弛处理没有消除这种不唯一，仍可能出现接触力分配的任意性（这属于刚体库仑模型本身的局限，并非由QP引入，但QP求解会选取其中一个能量最小解）。最后，因取消了碰撞中的速度跃变，模型相当于假设完全非弹性碰撞，这在实际物理中是常见近似但并非严格正确（不过只要步长足够小，此处理与真实冲量解接近）。综上，LCP→QP的转换并非严格保持原互补约束，在数值解中损失了精确的互补性（特别是法向与切向的完全互斥条件），并可能引入细微的非物理现象如高速摩擦下的振荡。然而，这些影响在小时间步下很小，且换来了模型求解的凸性和效率提升。在工程应用中，这种权衡是常见且可接受的：模型略有松弛，但整体行为依然合理且计算效率大大提高。
参考文献：
【2】 Mazhar et al. Using Nesterov’s Method to Accelerate Multibody Dynamics with Friction and Contact. ACM TOG, 2015
【5】 Mazhar et al. (ibid.), Section 2.3 Convexification Artifacts
【11】 Mazhar et al. (ibid.), Equations (6)-(8) and discussion
【12】 Mazhar et al. (ibid.), Eq.(9) and CCP formulation
【8】 Chrono::Engine Solver Code (ChIterativeSolverVI), constraint projection modes
【14】 Chrono::Engine Constraint Code (ChConstraint), compliance term (CFM)
________________________________________



## 相关知识点